---
title: Strangled by factors
author: Yen-Chung Chen
date: '2019-03-28'
slug: strangled-by-factors
categories:
  - R
tags:
  - R
image:
  caption: ''
  focal_point: ''
---
I am exaggerating, but sometimes `stringsAsFactors` is almost this deadly. I 
work with genomic data, and a common quest in my job is to identify 
interesting features (in most cases, genes) from a pool of 25,000+.

To climb onto giants' shoulders, genes that were repoted to be important in a 
certain process, say cell fate determination, are invaluable, and these genes 
often come in the supplementary tables of the original papers.

Reading the supplments into R and using those for analysis look dead simple, 
but this is when a wrong setting of `stringsAsFactors` can bite one hard.

I'll demonstrate this with everyone's favorite example set: `mtcars`.

Imagine it was reported that Honda Civic and Volvo 142E are particularly safe 
in a crash scene, and we want to fetch their information from `mtcars` for 
some detailed analysis. We notice he paper that reported _Honda Civic_ and 
_Volvo 142E_  provide a csv file containing the models that found like this:
```{r echo = FALSE}
suptbl <- data.frame("Model" = c("Honda Civic", "Volvo 142E"))
# write.csv(suptbl, file = "../../static/post/2019_03_28_table.csv", 
#           row.names = FALSE)
knitr::kable(suptbl, 
             caption = "Models that are robust in crash")
```

Now, I could not wait to find what are the specs of these models! Let's load 
the table and do some analysis!

```{r}
candidate_models <- read.csv(file = "../../static/post/2019_03_28_table.csv", 
                             header = TRUE)
print(candidate_models)
```

It looks great, so we can finally get the data we want.

```{r}

print(mtcars[candidate_models$Model, ])
```

Oh no. I get two completely different rows though I even `print` the candidates 
after reading the csv file.

This weird phenomenon results from the way factor 
works: A `factor` is categorical and coded by integers under the table, but 
displayed as character strings (`levels`). So, when I thought I was filtering 
rows with Honda Civic and Volvo 142E, I was actually doing `mtcars[c(1,2), ]`.

```{r}
head(mtcars)
```

In this example, it might be so obvious that you start wondering why people 
even see this as a problem, but when you are facing several dozens of 
candidates among thousands of features, this kind of errors can go unnoticed 
for really long.

To prevent this from happening, it is good to make it a habit to set 
`stringsAsFactors = FALSE`. To inspect the data you load, `str()` often 
provides more information than `print()` or `head()` (On the other hand, if you 
work with a `tibble`, `print()` shows variable types by default.) 

```{r}
str(candidate_models)
```

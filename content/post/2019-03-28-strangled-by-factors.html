---
title: Strangled by factors
author: Yen-Chung Chen
date: '2019-03-28'
slug: strangled-by-factors
categories:
  - R
tags:
  - R
image:
  caption: ''
  focal_point: ''
---



<p>I am exaggerating, but sometimes <code>stringsAsFactors</code> is almost this deadly. I
work with genomic data, and a common quest in my job is to identify
interesting features (in most cases, genes) from a pool of 25,000+.</p>
<p>To climb onto giants’ shoulders, genes that were repoted to be important in a
certain process, say cell fate determination, are invaluable, and these genes
often come in the supplementary tables of the original papers.</p>
<p>Reading the supplments into R and using those for analysis look dead simple,
but this is when a wrong setting of <code>stringsAsFactors</code> can bite one hard.</p>
<p>I’ll demonstrate this with everyone’s favorite example set: <code>mtcars</code>.</p>
<p>Imagine it was reported that Honda Civic and Volvo 142E are particularly safe
in a crash scene, and we want to fetch their information from <code>mtcars</code> for
some detailed analysis. We notice he paper that reported <em>Honda Civic</em> and
<em>Volvo 142E</em> provide a csv file containing the models that found like this:</p>
<table>
<caption><span id="tab:unnamed-chunk-1">Table 1: </span>Models that are robust in crash</caption>
<thead>
<tr class="header">
<th align="left">Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Honda Civic</td>
</tr>
<tr class="even">
<td align="left">Volvo 142E</td>
</tr>
</tbody>
</table>
<p>Now, I could not wait to find what are the specs of these models! Let’s load
the table and do some analysis!</p>
<pre class="r"><code>candidate_models &lt;- read.csv(file = &quot;../../static/post/2019_03_28_table.csv&quot;, 
                             header = TRUE)
print(candidate_models)</code></pre>
<pre><code>##         Model
## 1 Honda Civic
## 2  Volvo 142E</code></pre>
<p>It looks great, so we can finally get the data we want.</p>
<pre class="r"><code>print(mtcars[candidate_models$Model, ])</code></pre>
<pre><code>##               mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21   6  160 110  3.9 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21   6  160 110  3.9 2.875 17.02  0  1    4    4</code></pre>
<p>Oh no. I get two completely different rows though I even <code>print</code> the candidates
after reading the csv file.</p>
<p>This weird phenomenon results from the way factor
works: A <code>factor</code> is categorical and coded by integers under the table, but
displayed as character strings (<code>levels</code>). So, when I thought I was filtering
rows with Honda Civic and Volvo 142E, I was actually doing <code>mtcars[c(1,2), ]</code>.</p>
<pre class="r"><code>head(mtcars)</code></pre>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<p>In this example, it might be so obvious that you start wondering why people
even see this as a problem, but when you are facing several dozens of
candidates among thousands of features, this kind of errors can go unnoticed
for really long.</p>
<p>To prevent this from happening, it is good to make it a habit to set
<code>stringsAsFactors = FALSE</code>. To inspect the data you load, <code>str()</code> often
provides more information than <code>print()</code> or <code>head()</code> (On the other hand, if you
work with a <code>tibble</code>, <code>print()</code> shows variable types by default.)</p>
<pre class="r"><code>str(candidate_models)</code></pre>
<pre><code>## &#39;data.frame&#39;:    2 obs. of  1 variable:
##  $ Model: Factor w/ 2 levels &quot;Honda Civic&quot;,..: 1 2</code></pre>
